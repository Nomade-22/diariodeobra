<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Equipes & Ferramentas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root{--panel:rgba(15,23,42,.7)}
    canvas.signature{background:#fff;border-radius:12px;border:1px solid #cbd5e1}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-900 via-slate-950 to-black text-slate-100">
  <div class="max-w-6xl mx-auto p-4 md:p-8 space-y-6">
    <header class="flex items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold">Controle de Equipes & Ferramentas</h1>
        <p class="text-slate-300">GitHub Pages • Sem servidor • Exporta CSV</p>
      </div>
      <div class="flex gap-2">
        <button id="btnExportAll" class="px-3 py-2 rounded-lg bg-sky-600 hover:bg-sky-500">Exportar CSV (Tudo)</button>
      </div>
    </header>

    <nav class="grid grid-cols-3 w-full">
      <button data-tab="saida" class="tab px-3 py-2 border border-slate-700 bg-[var(--panel)]">Saída</button>
      <button data-tab="retorno" class="tab px-3 py-2 border border-slate-700">Retorno</button>
      <button data-tab="cadastros" class="tab px-3 py-2 border border-slate-700">Cadastros</button>
    </nav>

    <section id="tab-saida" class="rounded-xl border border-slate-800 p-4 bg-[var(--panel)] space-y-4">
      <h2 class="text-xl font-semibold">Registrar Saída</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-slate-300">Equipe</label>
          <select id="outTeam" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700"></select>
        </div>
        <div>
          <label class="block text-sm text-slate-300">Motorista</label>
          <input id="outDriver" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" placeholder="Nome do motorista" />
        </div>
        <div>
          <label class="block text-sm text-slate-300">Obra/Cliente</label>
          <select id="outJobsite" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700"></select>
        </div>
        <div>
          <label class="block text-sm text-slate-300">Veículo</label>
          <input id="outVehicle" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" placeholder="Placa/Identificação" />
        </div>
        <div>
          <label class="block text-sm text-slate-300">KM (Saída)</label>
          <input id="outKm" type="number" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" placeholder="Odômetro" />
        </div>
        <div>
          <label class="block text-sm text-slate-300">Horário de Saída</label>
          <input id="outTime" type="datetime-local" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" />
          <p class="text-xs text-slate-400" id="outNow"></p>
        </div>
      </div>
      <div>
        <label class="block text-sm text-slate-300">Observações</label>
        <textarea id="outObs" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" placeholder="Condições, ferramentas especiais, etc."></textarea>
      </div>
      <div>
        <label class="block text-sm text-slate-300 mb-2">Assinatura do Responsável (Saída)</label>
        <div class="flex items-center gap-2">
          <canvas id="outSign" class="signature w-full" height="160"></canvas>
          <button class="px-3 py-2 rounded-lg bg-slate-700" data-clear="outSign">Limpar</button>
        </div>
      </div>

      <div class="space-y-3">
        <div class="flex items-center justify-between">
          <h3 class="font-medium">Ferramentas para este trabalho</h3>
          <span class="text-sm text-slate-300" id="selCount">0 selecionadas</span>
        </div>
        <div class="rounded-xl border border-slate-800">
          <div class="grid grid-cols-12 gap-2 p-2 text-xs text-slate-400 border-b border-slate-800">
            <div class="col-span-1 text-center">OK</div>
            <div class="col-span-4">Ferramenta</div>
            <div class="col-span-3">Código</div>
            <div class="col-span-2">Qtd catálogo</div>
            <div class="col-span-2">Qtd levar</div>
          </div>
          <div id="pickList" class="max-h-72 overflow-auto"></div>
        </div>
      </div>

      <div>
        <label class="block text-sm text-slate-300 mb-1">Foto rápida (opcional)</label>
        <input id="outPhoto" type="file" accept="image/*" capture="environment" />
        <p class="text-xs text-slate-400" id="outPhotoCount">Nenhuma foto</p>
      </div>
      <div>
        <button id="btnCheckout" class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500">Confirmar Saída</button>
      </div>
    </section>

    <section id="tab-retorno" class="hidden rounded-xl border border-slate-800 p-4 bg-[var(--panel)] space-y-4">
      <h2 class="text-xl font-semibold">Registrar Retorno</h2>
      <div class="grid md:grid-cols-3 gap-4 items-end">
        <div>
          <label class="block text-sm text-slate-300">Saída em aberto</label>
          <select id="retOpen" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700"></select>
        </div>
        <div>
          <label class="block text-sm text-slate-300">KM (Retorno)</label>
          <input id="retKm" type="number" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" />
        </div>
        <div>
          <label class="block text-sm text-slate-300">Horário de Retorno</label>
          <input id="retTime" type="datetime-local" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" />
        </div>
      </div>
      <div>
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-medium">Checklist de Retorno</h3>
          <span id="retMissing" class="text-sm text-slate-300"></span>
        </div>
        <div id="retList" class="rounded-xl border border-slate-800 divide-y divide-slate-800"></div>
      </div>
      <div>
        <label class="block text-sm text-slate-300">Observações gerais</label>
        <textarea id="retNotes" class="w-full mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700"></textarea>
      </div>
      <div>
        <label class="block text-sm text-slate-300 mb-2">Assinatura do Responsável (Retorno)</label>
        <div class="flex items-center gap-2">
          <canvas id="retSign" class="signature w-full" height="160"></canvas>
          <button class="px-3 py-2 rounded-lg bg-slate-700" data-clear="retSign">Limpar</button>
        </div>
      </div>
      <div>
        <label class="block text-sm text-slate-300 mb-1">Foto do retorno (opcional)</label>
        <input id="retPhoto" type="file" accept="image/*" capture="environment" />
        <p class="text-xs text-slate-400" id="retPhotoCount">Nenhuma foto</p>
      </div>
      <div class="flex justify-end gap-2">
        <button id="btnExportReturn" class="px-4 py-2 rounded-lg bg-slate-700">CSV do Retorno</button>
        <button id="btnFinishReturn" class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500">Confirmar Retorno</button>
      </div>
    </section>

    <section id="tab-cadastros" class="hidden space-y-4">
      <div class="grid lg:grid-cols-3 gap-4">
        <div class="rounded-xl border border-slate-800 p-4 bg-[var(--panel)]">
          <h3 class="font-semibold mb-3">Ferramentas (Catálogo)</h3>
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm text-slate-300" id="toolsCount">0 itens</span>
            <button id="toolAdd" class="px-3 py-1.5 rounded-lg bg-slate-700">Adicionar</button>
          </div>
          <div class="grid grid-cols-12 gap-2 p-2 text-xs text-slate-400 border border-slate-800 rounded-lg">
            <div class="col-span-4">Ferramenta</div>
            <div class="col-span-3">Código</div>
            <div class="col-span-2">Qtd</div>
            <div class="col-span-3">Obs</div>
          </div>
          <div id="toolsList" class="max-h-72 overflow-auto rounded-lg border border-slate-800 mt-2"></div>
        </div>
        <div class="rounded-xl border border-slate-800 p-4 bg-[var(--panel)]">
          <h3 class="font-semibold mb-3">Equipes</h3>
          <div class="flex gap-2 mb-2">
            <input id="teamNew" class="flex-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" placeholder="Nome da equipe" />
            <button id="teamAdd" class="px-3 py-2 rounded-lg bg-slate-700">Adicionar</button>
          </div>
          <ul id="teamsList" class="space-y-2"></ul>
        </div>
        <div class="rounded-xl border border-slate-800 p-4 bg-[var(--panel)]">
          <h3 class="font-semibold mb-3">Obras/Clientes</h3>
          <div class="flex gap-2 mb-2">
            <input id="jobNew" class="flex-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-700" placeholder="Nome da obra/cliente" />
            <button id="jobAdd" class="px-3 py-2 rounded-lg bg-slate-700">Adicionar</button>
          </div>
          <ul id="jobsList" class="space-y-2"></ul>
        </div>
      </div>
      <div class="rounded-xl border border-slate-800 p-4 bg-[var(--panel)]">
        <h3 class="font-semibold mb-3">Relatórios Rápidos</h3>
        <div class="flex flex-wrap gap-2">
          <button id="btnExportOut" class="px-3 py-2 rounded-lg bg-slate-700">CSV de Saídas</button>
          <button id="btnExportRet" class="px-3 py-2 rounded-lg bg-slate-700">CSV de Retornos</button>
        </div>
      </div>
    </section>
  </div>
  <div id="diag" class="fixed bottom-3 right-3 text-xs px-2 py-1 rounded bg-slate-800/80 border border-slate-700">carregando…</div>
  <script defer src="app.js"></script>
</body>
</html>
